<div id="image-analyzer-app" style="min-height: 100vh; background: linear-gradient(to bottom right, #111827, #000000); padding: 2rem;">
  <div style="max-width: 56rem; margin: 0 auto;">
    
    <!-- Header -->
    <div style="text-align: center; margin-bottom: 3rem;">
      <h1 style="font-size: 3rem; font-weight: bold; color: white; margin-bottom: 1rem;">
        An√°lisis de Im√°genes con IA
      </h1>
      <p style="color: #9ca3af; font-size: 1.125rem;">
        Sube tus im√°genes y d√©jate llevar por la magia de la IA
      </p>
    </div>

    <!-- API Key Input -->
    <div id="api-setup" style="margin-bottom: 2rem; background: rgba(30, 58, 138, 0.3); border: 2px solid #3b82f6; border-radius: 0.5rem; padding: 1.5rem;">
      <h3 style="color: #93c5fd; font-weight: 600; margin-bottom: 0.5rem;">Configuraci√≥n Necesaria</h3>
      <p style="color: #93c5fd; font-size: 0.875rem; margin-bottom: 1rem;">
        Para usar esta herramienta, necesitas una API key de Anthropic (es gratis).
        <a href="https://console.anthropic.com/keys" target="_blank" rel="noopener noreferrer" style="color: #60a5fa; text-decoration: underline;">
          Obt√©n tu API key aqu√≠ ‚Üí
        </a>
      </p>
      <input 
        type="password" 
        id="api-key-input" 
        placeholder="Ingresa tu API key de Anthropic aqu√≠" 
        style="width: 100%; padding: 0.75rem; background: #1f2937; color: white; border: 1px solid #374151; border-radius: 0.375rem; font-size: 1rem;"
      />
    </div>

    <!-- Mode Selection -->
    <div id="mode-selection" style="display: none; margin-bottom: 2rem;">
      <p style="color: #d1d5db; margin-bottom: 1rem; font-weight: 600;">Selecciona el tipo de descripci√≥n:</p>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
        <button 
          onclick="setMode('ecommerce')" 
          style="background: linear-gradient(135deg, #2563eb, #1e40af); color: white; padding: 2rem; border-radius: 0.5rem; border: none; cursor: pointer; transition: all 0.3s; font-weight: 600; font-size: 1.125rem;"
          onmouseover="this.style.transform='scale(1.05)'"
          onmouseout="this.style.transform='scale(1)'"
        >
          üõçÔ∏è E-commerce
        </button>
        <button 
          onclick="setMode('editorial')" 
          style="background: linear-gradient(135deg, #9333ea, #6b21a8); color: white; padding: 2rem; border-radius: 0.5rem; border: none; cursor: pointer; transition: all 0.3s; font-weight: 600; font-size: 1.125rem;"
          onmouseover="this.style.transform='scale(1.05)'"
          onmouseout="this.style.transform='scale(1)'"
        >
          üì∏ Editorial
        </button>
      </div>
    </div>

    <!-- Upload Area -->
    <div id="upload-area" style="display: none; margin-bottom: 2rem;">
      <label style="display: block; cursor: pointer;">
        <div 
          id="drop-zone"
          style="border: 2px dashed #4b5563; border-radius: 0.5rem; padding: 2rem; text-align: center; background: rgba(31, 41, 55, 0.5); transition: all 0.3s;"
          ondrop="handleDrop(event)"
          ondragover="handleDragOver(event)"
          ondragleave="handleDragLeave(event)"
        >
          <p style="color: white; font-size: 1.125rem; font-weight: 600; margin-bottom: 0.5rem;">
            üìÅ Arrastra im√°genes aqu√≠ o haz clic
          </p>
          <p style="color: #9ca3af; font-size: 0.875rem;">
            PNG, JPG, WebP - La IA analizar√° autom√°ticamente
          </p>
        </div>
        <input 
          type="file" 
          id="file-input" 
          multiple 
          accept="image/*" 
          style="display: none;"
          onchange="handleFileSelect(event)"
        />
      </label>
    </div>

    <!-- Images Container -->
    <div id="images-container" style="display: grid; gap: 2rem;"></div>

    <!-- No Images Message -->
    <div id="no-images-message" style="display: none; text-align: center; padding: 3rem; color: #9ca3af; font-size: 1.125rem;">
      Sube im√°genes para que la IA las analice y genere descripciones
    </div>

  </div>
</div>

<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
  }

  .image-card {
    background: #1f2937;
    border-radius: 0.5rem;
    overflow: hidden;
    box-shadow: 0 20px 25px rgba(0, 0, 0, 0.5);
  }

  .image-card-content {
    display: flex;
    flex-direction: row;
    gap: 1.5rem;
    padding: 1.5rem;
  }

  .image-preview {
    width: 33.333%;
    flex-shrink: 0;
  }

  .image-preview img {
    width: 100%;
    height: 16rem;
    object-fit: cover;
    border-radius: 0.5rem;
  }

  .image-filename {
    color: #9ca3af;
    font-size: 0.875rem;
    margin-top: 0.75rem;
    word-break: break-word;
  }

  .image-description {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }

  .description-title {
    color: white;
    font-weight: 600;
    margin-bottom: 0.75rem;
  }

  .description-text {
    color: #d1d5db;
    font-size: 0.875rem;
    line-height: 1.5;
    background: rgba(55, 65, 81, 0.5);
    padding: 1rem;
    border-radius: 0.375rem;
    max-height: 12rem;
    overflow-y: auto;
    white-space: pre-wrap;
  }

  .loading {
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .spinner {
    display: inline-block;
    width: 1.25rem;
    height: 1.25rem;
    border: 2px solid #3b82f6;
    border-top-color: transparent;
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  .error-box {
    background: rgba(159, 18, 57, 0.3);
    border: 1px solid #f87171;
    border-radius: 0.375rem;
    padding: 1rem;
  }

  .error-text {
    color: #fca5a5;
    font-size: 0.875rem;
  }

  .button-group {
    display: flex;
    gap: 0.75rem;
    margin-top: 1rem;
  }

  .button {
    padding: 0.5rem 1rem;
    border: none;
    border-radius: 0.375rem;
    cursor: pointer;
    font-weight: 600;
    font-size: 0.875rem;
    transition: all 0.3s;
    flex: 1;
  }

  .button-copy {
    background: #2563eb;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
  }

  .button-copy:hover {
    background: #1d4ed8;
  }

  .button-delete {
    background: #dc2626;
    color: white;
    width: auto;
  }

  .button-delete:hover {
    background: #b91c1c;
  }

  .drop-zone-drag {
    background: rgba(37, 99, 235, 0.1) !important;
    border-color: #3b82f6 !important;
  }

  @media (max-width: 768px) {
    .image-card-content {
      flex-direction: column;
    }

    .image-preview {
      width: 100%;
    }

    .image-description {
      width: 100%;
    }

    .button-group {
      flex-direction: column;
    }
  }
</style>

<script>
  // ‚ö†Ô∏è CAMBIAR ESTO A TU URL DE VERCEL
  const VERCEL_API_URL = 'https://TU_PROYECTO_VERCEL.vercel.app/api/analyzeImage';

  let currentMode = null;
  let apiKey = '';
  let images = [];

  const apiKeyInput = document.getElementById('api-key-input');
  const modeSelection = document.getElementById('mode-selection');
  const uploadArea = document.getElementById('upload-area');
  const dropZone = document.getElementById('drop-zone');
  const fileInput = document.getElementById('file-input');
  const imagesContainer = document.getElementById('images-container');
  const noImagesMessage = document.getElementById('no-images-message');

  // API Key Validation
  apiKeyInput.addEventListener('input', (e) => {
    apiKey = e.target.value.trim();
    if (apiKey) {
      modeSelection.style.display = 'block';
    } else {
      modeSelection.style.display = 'none';
      uploadArea.style.display = 'none';
      currentMode = null;
    }
  });

  function setMode(mode) {
    currentMode = mode;
    uploadArea.style.display = 'block';
    updateImagesDisplay();
  }

  function handleDragOver(e) {
    e.preventDefault();
    e.stopPropagation();
    dropZone.classList.add('drop-zone-drag');
  }

  function handleDragLeave(e) {
    e.preventDefault();
    e.stopPropagation();
    dropZone.classList.remove('drop-zone-drag');
  }

  function handleDrop(e) {
    e.preventDefault();
    e.stopPropagation();
    dropZone.classList.remove('drop-zone-drag');
    
    const files = Array.from(e.dataTransfer.files).filter(f => f.type.startsWith('image/'));
    processFiles(files);
  }

  function handleFileSelect(e) {
    const files = Array.from(e.target.files);
    processFiles(files);
  }

  function processFiles(files) {
    if (!apiKey) {
      alert('Por favor ingresa tu API key primero');
      return;
    }

    files.forEach((file) => {
      const reader = new FileReader();
      reader.onload = (event) => {
        const imageData = {
          id: Date.now() + Math.random(),
          src: event.target.result,
          fileName: file.name,
          description: '',
          loading: true,
          error: null,
        };
        images.push(imageData);
        updateImagesDisplay();
        generateDescription(imageData.id, event.target.result, file.type);
      };
      reader.readAsDataURL(file);
    });
  }

  async function generateDescription(imageId, imageSrc, mimeType) {
    const imageData = images.find(img => img.id === imageId);
    if (!imageData) return;

    try {
      const base64Image = imageSrc.split(',')[1];

      const response = await fetch(VERCEL_API_URL, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          imageBase64: base64Image,
          imageType: mimeType,
          mode: currentMode,
          apiKey: apiKey,
        }),
      });

      if (!response.ok) {
        const errorData = await response.json();
        throw new Error(errorData.error || `Error ${response.status}`);
      }

      const data = await response.json();
      imageData.description = data.description;
      imageData.loading = false;
      imageData.error = null;
    } catch (error) {
      console.error('Error:', error);
      imageData.loading = false;
      imageData.error = error.message || 'Error al generar descripci√≥n';
    }

    updateImagesDisplay();
  }

  function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(() => {
      alert('¬°Descripci√≥n copiada al portapapeles!');
    });
  }

  function removeImage(imageId) {
    images = images.filter(img => img.id !== imageId);
    updateImagesDisplay();
  }

  function updateImagesDisplay() {
    imagesContainer.innerHTML = '';

    if (images.length === 0) {
      noImagesMessage.style.display = 'block';
      return;
    }

    noImagesMessage.style.display = 'none';

    images.forEach((image) => {
      const card = document.createElement('div');
      card.className = 'image-card';

      let descriptionContent = '';
      if (image.loading) {
        descriptionContent = `
          <div class="loading">
            <div class="spinner"></div>
            <p style="color: #9ca3af;">Analizando con IA...</p>
          </div>
        `;
      } else if (image.error) {
        descriptionContent = `
          <div class="error-box">
            <p class="error-text">${image.error}</p>
          </div>
        `;
      } else {
        descriptionContent = `<div class="description-text">${image.description}</div>`;
      }

      const buttonGroup = !image.loading && !image.error ? `
        <div class="button-group">
          <button class="button button-copy" onclick="copyToClipboard(\`${image.description.replace(/`/g, '\\`')}\`)">
            üìã Copiar
          </button>
          <button class="button button-delete" onclick="removeImage(${image.id})">
            üóëÔ∏è
          </button>
        </div>
      ` : '';

      card.innerHTML = `
        <div class="image-card-content">
          <div class="image-preview">
            <img src="${image.src}" alt="${image.fileName}" />
            <div class="image-filename">${image.fileName}</div>
          </div>
          <div class="image-description">
            <div>
              <div class="description-title">Descripci√≥n (IA):</div>
              ${descriptionContent}
            </div>
            ${buttonGroup}
          </div>
        </div>
      `;

      imagesContainer.appendChild(card);
    });
  }

  // Initialize
  updateImagesDisplay();
</script>
